
<!DOCTYPE html>
<html lang="en" prefix="og: https://ogp.me/ns#">
<head>
	<title>JNI Library as Uber JAR</title>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="See how to create an uber JAR containing all buildable Java Native Interface (JNI) shared library binaries with the Gradle Nokee plugins.">
<meta name="author" content="@nokeedev">
<meta name="keywords" content="sample, jni, java, jvm, native, c++, testing, gradle, uber jar">

<link rel="canonical" href="https://docs.nokee.dev/samples/jni-library-as-uber-jar/">
<meta property="og:url" content="https://docs.nokee.dev/samples/jni-library-as-uber-jar/">





<script type="application/ld+json">
    [{
      "@context": "https://schema.org",
      "@type": "BreadcrumbList",
      "itemListElement": [{
  "@type": "ListItem",
  "position": 1,
  "name": "Samples",
  "item": "https://docs.nokee.dev/docs/current/samples/"
},{
  "@type": "ListItem",
  "position": 2,
  "name": "JNI Library as Uber JAR",
  "item": "https://docs.nokee.dev/samples/jni-library-as-uber-jar/"
}]
    }]
</script>




<meta property="og:site_name" content="Nokee">
<meta property="og:title" content="JNI Library as Uber JAR">
<meta name="og:description" content="See how to create an uber JAR containing all buildable Java Native Interface (JNI) shared library binaries with the Gradle Nokee plugins.">



<meta name="twitter:site" content="@nokeedev">
<meta name="twitter:creator" content="@nokeedev">
<meta name="twitter:title" content="JNI Library as Uber JAR">
<meta name="twitter:card" content="player">
<meta name="twitter:description" content="See how to create an uber JAR containing all buildable Java Native Interface (JNI) shared library binaries with the Gradle Nokee plugins.">



<!-- Le styles -->
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans&family=Rajdhani" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Lato&display=swap" rel="stylesheet">
<link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
<link href="/css/normalize-8.0.1.css" rel="stylesheet">
<link href="/css/prettify.css" rel="stylesheet">
<link href="/css/menu.css" rel="stylesheet">

<link href="/css/colorscheme-light.css" rel="stylesheet">


<!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
<!--[if lt IE 9]>
<script src="/js/html5shiv.min.js"></script>
<![endif]-->

<!-- Fav and touch icons -->
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#001824">
<meta name="msapplication-TileColor" content="#00a300">
<meta name="theme-color" content="#ffffff">


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-157599764-1"></script>
<script>
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());

	gtag('config', 'UA-157599764-1');
</script>


<!-- Le styles -->
<link href="/css/docs-asciidoctor.css" rel="stylesheet">
<link href="/css/docs-asciidoctor-docs-layout.css" rel="stylesheet">
<link href="/css/docs-asciidoctor-override.css" rel="stylesheet">
<link href="/css/docs-asciidoctor-color-override.css" rel="stylesheet">
<link href="/css/docs-base.css" rel="stylesheet">
<link href="/css/multi-language-sample.css" rel="stylesheet">

	<link href="/css/docs-samples.css" rel="stylesheet">
	
	<meta name="twitter:player" content="https://docs.nokee.dev/samples/jni-library-as-uber-jar/all-commands.embed.html">
	<meta name="twitter:image" content="https://docs.nokee.dev/samples/jni-library-as-uber-jar/all-commands.png">
	<meta name="twitter:player:width" content="1179">
	<meta name="twitter:player:height" content="792">
	
</head>
<body onload="prettyPrint()">

	
<nav class="navigation" aria-labelledby="primary-navigation">
	<a href="https://nokee.dev" class="logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 49.96"><defs></defs><g id="Layer_2" data-name="Layer 2"><g id="Layer_1-2" data-name="Layer 1"><g id="full-dark"><g id="nokee"><path d="M180.38,40.13a6.32,6.32,0,0,1-6.25-6.25V18.37a6.32,6.32,0,0,1,6.25-6.25H193.8A5.92,5.92,0,0,1,198.17,14a6,6,0,0,1,1.83,4.4V28.88H180.49s-.05,4.85,0,4.89,19.51.07,19.51.07v6.29Zm.11-16.84h13.15V18.48H180.49Z"/><path d="M51.3,40.13v-28H71A6,6,0,0,1,75.34,14a6,6,0,0,1,1.83,4.4V40.13H70.88l-.07-21.65H57.65l-.06,21.65Z"/><path d="M88.94,40.13a6.32,6.32,0,0,1-6.25-6.25V18.37a6.32,6.32,0,0,1,6.25-6.25h13.42A6,6,0,0,1,106.74,14a6.07,6.07,0,0,1,1.82,4.4V33.88a6.05,6.05,0,0,1-1.82,4.4,5.92,5.92,0,0,1-4.38,1.85Zm13.26-6.36s0-15.29,0-15.29H89.05s0,15.25,0,15.29S102.16,33.82,102.2,33.77Z"/><path d="M114.13,40.13V6.26h6.29V23.38h4l8.84-11.28h8.19L129.92,26.54l11.49,13.59h-8.19l-8.84-10.42h-4V40.13Z"/><path d="M149.25,40.13A6.32,6.32,0,0,1,143,33.88V18.37a6.32,6.32,0,0,1,6.25-6.25h13.42A6,6,0,0,1,167.05,14a6.07,6.07,0,0,1,1.82,4.4V28.88H149.36s-.05,4.85,0,4.89,19.51.07,19.51.07v6.29Zm.11-16.84h13.15V18.48H149.36Z"/></g><g id="bird"><path d="M41.82,10.21,25.58.83a6.24,6.24,0,0,0-6.23,0L3.11,10.21A6.24,6.24,0,0,0,0,15.6V34.35a6.25,6.25,0,0,0,3.11,5.4l16.24,9.37a6.24,6.24,0,0,0,6.23,0l16.24-9.37a6.25,6.25,0,0,0,3.11-5.4V15.6A6.24,6.24,0,0,0,41.82,10.21Zm-6,10.92c0,12.59-7.92,17.46-21.73,17.46A16.46,16.46,0,0,1,5,36c8.22-5.58,10.56-9.95,12.4-17.5,1.11-4.54,4.25-8.06,9.22-8.06,3.6,0,6.62,1.28,8.14,4.7h6.5l-5.49,4.39C35.82,20,35.84,20.57,35.84,21.13Z"/><path d="M28.94,13.72a3.35,3.35,0,0,0-3,1.76.83.83,0,0,0,1.46.79,1.7,1.7,0,0,1,3,0,.83.83,0,0,0,1.13.33.82.82,0,0,0,.33-1.12A3.36,3.36,0,0,0,28.94,13.72Z"/></g></g></g></g></svg></a>
	<input class="navigation-hamburger" type="checkbox" id="navigation-hamburger" />
	<label class="menu-icon" for="navigation-hamburger"><span class="navicon"></span></label>
	<ul class="navigation-items">
		<li><a href="https://docs.nokee.dev">Docs</a></li>
		<li><a href="https://blog.nokee.dev">Blog</a></li>
		<li><a href="https://nokee.dev/services/consulting.html">Services</a></li>
		<li>
			<ul class="navigation-socials">
				<li class="navigation-twitter"><a href="https://twitter.com/nokeedev" title="Nokee on Twitter"><svg width="24" height="24" viewBox="0 0 56.693 56.693" xmlns="http://www.w3.org/2000/svg"><path d="M28.348,5.157c-13.6,0-24.625,11.027-24.625,24.625c0,13.6,11.025,24.623,24.625,24.623c13.6,0,24.623-11.023,24.623-24.623  C52.971,16.184,41.947,5.157,28.348,5.157z M40.752,24.817c0.013,0.266,0.018,0.533,0.018,0.803c0,8.201-6.242,17.656-17.656,17.656  c-3.504,0-6.767-1.027-9.513-2.787c0.486,0.057,0.979,0.086,1.48,0.086c2.908,0,5.584-0.992,7.707-2.656  c-2.715-0.051-5.006-1.846-5.796-4.311c0.378,0.074,0.767,0.111,1.167,0.111c0.566,0,1.114-0.074,1.635-0.217  c-2.84-0.57-4.979-3.08-4.979-6.084c0-0.027,0-0.053,0.001-0.08c0.836,0.465,1.793,0.744,2.811,0.777  c-1.666-1.115-2.761-3.012-2.761-5.166c0-1.137,0.306-2.204,0.84-3.12c3.061,3.754,7.634,6.225,12.792,6.483  c-0.106-0.453-0.161-0.928-0.161-1.414c0-3.426,2.778-6.205,6.206-6.205c1.785,0,3.397,0.754,4.529,1.959  c1.414-0.277,2.742-0.795,3.941-1.506c-0.465,1.45-1.448,2.666-2.73,3.433c1.257-0.15,2.453-0.484,3.565-0.977  C43.018,22.849,41.965,23.942,40.752,24.817z"/></svg></a></li>
				<li class="navigation-github"><a href="https://github.com/nokeedev" title="Nokee on GitHub"><svg width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M10 0C4.477 0 0 4.477 0 10c0 4.418 2.865 8.166 6.839 9.489.5.092.682-.217.682-.482 0-.237-.008-.866-.013-1.7-2.782.603-3.369-1.342-3.369-1.342-.454-1.155-1.11-1.462-1.11-1.462-.908-.62.069-.608.069-.608 1.003.07 1.531 1.03 1.531 1.03.892 1.529 2.341 1.087 2.91.831.092-.646.35-1.086.636-1.336-2.22-.253-4.555-1.11-4.555-4.943 0-1.091.39-1.984 1.029-2.683-.103-.253-.446-1.27.098-2.647 0 0 .84-.268 2.75 1.026A9.578 9.578 0 0 1 10 4.836c.85.004 1.705.114 2.504.337 1.909-1.294 2.747-1.026 2.747-1.026.546 1.377.203 2.394.1 2.647.64.699 1.028 1.592 1.028 2.683 0 3.842-2.339 4.687-4.566 4.935.359.309.678.919.678 1.852 0 1.336-.012 2.415-.012 2.743 0 .267.18.579.688.481C17.137 18.163 20 14.418 20 10c0-5.523-4.478-10-10-10" fill-rule="evenodd"></path></svg></a></li>
			</ul>
		</li>
	</ul>
</nav>

	<main class="main-content">
		
<nav class="docs-navigation">
	<div class="breadcrumbs"><ul><li><a href="../samples/">Samples</a></li><li><a href="/samples/jni-library-as-uber-jar/index.html">JNI Library as Uber JAR</a></li></ul></div>
	<input class="docs-navigation-hamburger" type="checkbox" id="docs-navigation-hamburger" />
	<label class="menu-icon" for="docs-navigation-hamburger"><span class="fa navicon"></span></label>
	<div class="navigation-items">
		<ul>
			<li><a href="../manual/user-manual.html">Docs Home</a></li>
			<li><a href="../samples/">Samples</a></li>
			<li><a href="../release-notes.html">Release Notes</a></li>
			<li><a href="../javadoc/index.html">Nokee Javadoc API</a></li>
			<li><a href="../dsl/index.html">Nokee DSL Reference</a></li>
		</ul>
		<h3 id="user-manual">User Manual </h3>
		<ul>
			<li><a href="../manual/getting-started.html">Getting Started</a></li>
			<li><a href="../manual/plugin-anatomy.html">Anatomy of a Nokee Plugin</a></li>
			<li><a href="../manual/building-jni-projects.html">Building JNI Projects</a></li>
			<li><a href="../manual/building-native-projects.html">Building Native Projects</a></li>
			<li><a href="../manual/developing-with-xcode-ide.html">Developing with Xcode IDE</a></li>
			<li><a href="../manual/gradle-plugin-development.html">Gradle Plugin Development</a></li>
			<li><a href="../manual/terminology.html">Terminology</a></li>
		</ul>
		<h3 id="reference">Reference</h3>
		<ul>
			<li><a href="../manual/plugin-references.html">Nokee Plugins</a></li>
			<ul>
				<li><a href="../manual/plugin-references.html#sec:plugin-reference-native-development">Native Development</a></li>
				<li><a href="../manual/plugin-references.html#sec:plugin-reference-ios">iOS Development</a></li>
				<li><a href="../manual/plugin-references.html#sec:plugin-reference-jvm">JNI Development</a></li>
				<li><a href="../manual/xcode-ide-plugin.html">Xcode IDE</a></li>
				<li><a href="../manual/plugin-references.html#sec:plugin-reference-gradledev">Gradle Plugin Development</a></li>
			</ul>
		</ul>
	</div>
</nav>


		<div class="chapter">
			<div id="header">
				<h1>JNI Library as Uber JAR</h1>
			</div>

			<div class="download">
				<ul>
					<li>
						<p><a href="JniLibraryAsUberJar-0.5.0-930919a0-groovy-dsl.zip"><span class="icon"><i class="fa fa-download"></i></span> Groovy DSL</a></p>
					</li>
					<li>
						<p><a href="JniLibraryAsUberJar-0.5.0-930919a0-kotlin-dsl.zip"><span class="icon"><i class="fa fa-download"></i></span> Kotlin DSL</a></p>
					</li>
				</ul>
			</div>

			<div id="content">
				<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can open this sample inside an IDE using the <a href="https://www.jetbrains.com/help/idea/gradle.html#gradle_import_project_start">IntelliJ native importer</a> or <a href="https://projects.eclipse.org/projects/tools.buildship">Eclipse Buildship</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This sample shows how to create a single JAR containing the JVM code and all the buildable shared library binaries of a Java Native Interface (JNI) library.
The library has no dependencies and targets Windows x64, Linux x86-64 and macOS x86-64.</p>
</div>
<div class="paragraph">
<p>In this sample, we use a JNI library implemented in Java and C&#43;&#43;; however, this applies to other JVM and native languages as well.</p>
</div>
<div class="paragraph">
<p>JNI libraries producing a single variant, the shared library binary will be included inside the JVM JAR.
The JVM JAR refers to the JAR containing all the JVM classes.
When the library produces multiple variants, Gradle produces an additional, separated, JAR, referred to as the JNI JAR, for each variant. The JNI JAR contains only the shared library binary and a manifest file.
In the event where releasing a single JAR containing both the classes and the shared library binaries for a platform is preferable, it is possible to create an uber JAR.
The following code creates a new JAR task, i.e. <code>uberJar</code>, that merge the content of the JVM and JNI JARs.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">plugins {
	id 'java'
	id 'dev.nokee.jni-library'
	id 'dev.nokee.cpp-language'
}


import dev.nokee.platform.jni.JarBinary
import dev.nokee.platform.jni.JniJarBinary
import dev.nokee.platform.jni.JvmJarBinary
import dev.nokee.platform.nativebase.TargetMachine

library {
	targetMachines = [machines.macOS, machines.linux, machines.windows]
}

/**
 * Returns a Groovy closure that convert a {@link JniJarBinary} or a {@link JvmJarBinary} to a {@link FileTree}
 * representing the JAR content.
 *
 * @return a transformer of {@link JarBinary} instances to {@link FileTree} of their JAR content.
 */
def asZipTree() {
	return { jarBinary -&gt;
		jarBinary.jarTask.map { zipTree(it.archiveFile) }
	}
}

boolean isHostTargeted(TargetMachine targetMachine) {
	String osName = System.getProperty('os.name').toLowerCase().replace(' ', '')
	def osFamily = targetMachine.operatingSystemFamily
	if (osFamily.windows &amp;&amp; osName.contains('windows')) {
		return true
	} else if (osFamily.linux &amp;&amp; osName.contains('linux')) {
		return true
	} else if (osFamily.macOs &amp;&amp; osName.contains('macos')) {
		return true
	}
	return false
}

tasks.register("uberJar", Jar) {
	from(library.variants.flatMap { variant -&gt;
		def result = []
		if (isHostTargeted(variant.targetMachine)) {
			result &lt;&lt; variant.binaries.withType(JniJarBinary).map(asZipTree())
		}
		return result
	}) { <i class="conum" data-value="1"></i><b>(1)</b>
		exclude 'META-INF/**'
	}
	from(library.binaries.withType(JvmJarBinary).map(asZipTree()))   <i class="conum" data-value="2"></i><b>(2)</b>
	archiveClassifier = "uber"
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock multi-language-sample">
<div class="content">
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-kotlin" data-lang="kotlin">plugins {
	id("java")
	id("dev.nokee.jni-library")
	id("dev.nokee.cpp-language")
}

import dev.nokee.platform.jni.JarBinary
import dev.nokee.platform.jni.JvmJarBinary
import dev.nokee.platform.jni.JniJarBinary
import dev.nokee.platform.nativebase.TargetMachine

library {
	targetMachines.set(listOf(machines.macOS, machines.linux, machines.windows))
}

/**
 * Returns a transfomer that convert a list of {@link JniJarBinary} or {@link JvmJarBinary} to a list of {@link FileTree}
 * representing the JAR content.
 *
 * @return a transformer of {@link JarBinary} instances to {@link FileTree} of their JAR content.
 */
fun asZipTree(): (JarBinary) -&gt; Provider&lt;FileTree&gt; {
	return { jarBinary: JarBinary -&gt;
		jarBinary.jarTask.map { zipTree(it.archiveFile) }
	}
}

fun isHostTargeted(targetMachine: TargetMachine): Boolean {
	val osName = System.getProperty("os.name").toLowerCase().replace(" ", "")
	val osFamily = targetMachine.operatingSystemFamily
	if (osFamily.isWindows &amp;&amp; osName.contains("windows")) {
		return true
	} else if (osFamily.isLinux &amp;&amp; osName.contains("linux")) {
		return true
	} else if (osFamily.isMacOs &amp;&amp; osName.contains("macos")) {
		return true
	}
	return false
}

tasks.register&lt;Jar&gt;("uberJar") {
	from(library.variants.flatMap { variant -&gt;
		val result = ArrayList&lt;Provider&lt;List&lt;Provider&lt;FileTree&gt;&gt;&gt;&gt;()
		if (isHostTargeted(variant.targetMachine)) {
			result.add(variant.binaries.withType(JniJarBinary::class.java).map(asZipTree()))
		}
		result
	}) { <i class="conum" data-value="1"></i><b>(1)</b>
		exclude("META-INF/**")
	}
	from(library.binaries.withType(JvmJarBinary::class.java).map(asZipTree()))   <i class="conum" data-value="2"></i><b>(2)</b>
	archiveClassifier.set("uber")
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Filtering all the binaries of the library for JNI JAR binaries.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Filtering all the binaries of the library for JVM JAR binaries.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To create the uber JAR:</p>
</div>
<div class="listingblock terminal">
<div class="content">
<pre>$ ./gradlew uberJar

BUILD SUCCESSFUL
6 actionable tasks: 6 executed</pre>
</div>
</div>
<div class="paragraph">
<p>It will create the uber JAR together with the JVM and JNI JARs:</p>
</div>
<div class="listingblock terminal">
<div class="content">
<pre>$ ls ./build/libs/*.jar
./build/libs/jni-library-as-uber-jar-macos.jar
./build/libs/jni-library-as-uber-jar-uber.jar
./build/libs/jni-library-as-uber-jar.jar</pre>
</div>
</div>
<div class="paragraph">
<p>We can inspect the content of JARs to reveal the intended result:</p>
</div>
<div class="listingblock terminal">
<div class="content">
<pre>$ jar tf ./build/libs/jni-library-as-uber-jar-macos.jar
META-INF/
META-INF/MANIFEST.MF
macos/
macos/libjni-library-as-uber-jar.dylib

$ jar tf ./build/libs/jni-library-as-uber-jar.jar
META-INF/
META-INF/MANIFEST.MF
com/
com/example/
com/example/greeter/
com/example/greeter/NativeLoader.class
com/example/greeter/Greeter.class

$ jar tf ./build/libs/jni-library-as-uber-jar-uber.jar
META-INF/
META-INF/MANIFEST.MF
macos/
macos/libjni-library-as-uber-jar.dylib
com/
com/example/
com/example/greeter/
com/example/greeter/NativeLoader.class
com/example/greeter/Greeter.class</pre>
</div>
</div>
<div class="paragraph">
<p>For more information, see <a href="../../manual/jni-library-plugin.html">JNI Library Plugin reference chapter</a>.</p>
</div>
			</div>
		</div>
		<aside class="secondary-navigation"></aside>
	</main>

	<div id="push"></div>
	<div id="footer">
		<div class="container">
			<p class="muted credit">&copy; 2020</p>
		</div>
	</div>

	<gdpr-banner></gdpr-banner>
<script src="/js/gdpr-banner.js" type="module"></script>

	<!-- Le javascript
	================================================== -->
	<!-- Placed at the end of the document so the pages load faster -->
	<script src="/js/prettify.js"></script>
	<script src="/js/multi-language-sample.js"></script>
	<script src="/js/active-link.js"></script>

</body>
</html>
